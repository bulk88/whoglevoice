function wvCopyToClipboard(t,n){var e;var o=document.createElement("input");o.value=t;document.body.appendChild(o);o.select();o.setSelectionRange(0,99999);try{r=document.execCommand("copy");if(!r){throw'document.execCommand("copy") returned false'}e=1}catch(e){alert("Copy Failed: "+e);r=document.createElement("textarea");r.value=t;r=document.createElement("label").appendChild(r).parentNode;r.insertBefore(document.createTextNode("Auto Copy failed. Copy this manually:"),r.firstChild);n.parentNode.insertBefore(r,n.nextSibling);n.parentNode.removeChild(n);r.lastChild.select()}document.body.removeChild(o);return e}function wvWipeAuthToken(){localStorage.removeItem("gvauthobj")}function drawLoginBar(){var e=document.getElementById("sign-in-bar");if(!e)return;while(e.lastChild){e.removeChild(e.lastChild)}var t=lazySignedInEmail();if(t.length){e.appendChild(document.createTextNode("Signed in: "+t));var n=e.appendChild(document.createElement("button"));n.innerText="Logout";n.addEventListener("click",function(){wvWipeAuthToken();drawLoginBar()})}else{e.appendChild(document.createTextNode("Logged out"));var n=e.appendChild(document.createElement("button"));n.innerText="Login";n.addEventListener("click",function(){getAuthToken(function(){})})}}function lazySignedInEmail(){var t=localStorage.getItem("gvauthobj");if(t){try{t=JSON.parse(t);if(!("access_token"in t)){t=undefined}}catch(e){t=undefined}}if(t)return t.profile.email;else return""}function lazySignedInUserIndex(){var t=localStorage.getItem("gvauthobj");if(t){try{t=JSON.parse(t);if(!("access_token"in t)){t=undefined}}catch(e){t=undefined}}if(t)return t.session_state.extraQueryParams.authuser;else throw"Not logged in."}function getAuthToken(n){var o=localStorage.getItem("gvauthobj");if(o){try{o=JSON.parse(o);if(!("access_token"in o)){o=undefined}}catch(e){o=undefined}}if(o){n(o.access_token)}else{var a=document.documentElement.removeChild(document.documentElement.getElementsByTagName("body")[0]);var r=document.documentElement.appendChild(document.createElement("body"));var e=r.appendChild(document.createElement("button"));e.innerText="Copy to Clipboard Bookmarklet to run on GV";e.addEventListener("click",function(e){wvCopyToClipboard('javascript:var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&200==e.status&&eval(e.responseText)};e.open("GET","https://wvoice.us.to/getCredFull.js",!0);e.overrideMimeType("application/javascript");e.send();',e.target)});r.appendChild(document.createElement("br"));var t=r.appendChild(document.createElement("a"));t.setAttribute("href","https://voice.google.com/about");t.setAttribute("target","_blank");r.appendChild(document.createElement("br"));t.innerText="Open Google Voice Site";var s=r.appendChild(document.createElement("textarea"));s.placeholder="Paste GV Auth Token here";var i=function(e){var t=e.type=="input"?e.target.value:(e.clipboardData||event&&event.clipboardData||window.clipboardData).getData("text");try{o=JSON.parse(t);if(!("access_token"in o)){alert("No GV Auth data found in pasted string:\n\n"+t);o=undefined}}catch(e){alert("No GV Auth data found in pasted string:\n\n"+t);o=undefined}document.documentElement.replaceChild(a,r);if(o){localStorage.setItem("gvauthobj",t);n(o.access_token)}else{n("USER_PASTED_UNKNOWN_AUTH_INFO")}drawLoginBar()};s.addEventListener("input",i);s.addEventListener("paste",i);r.appendChild(document.createElement("br"));var e=r.appendChild(document.createElement("button"));e.innerText="Cancel/Return";e.addEventListener("click",function(){document.documentElement.replaceChild(a,r);n("USER_CLICKED_CANCEL");drawLoginBar()})}}if(!Uint8Array.prototype.map){Uint8Array.prototype.map=function(e){var t,n,o;if(this==null){throw new TypeError("this is null or not defined")}var a=Object(this);var r=a.length>>>0;if(typeof e!=="function"){throw new TypeError(e+" is not a function")}if(arguments.length>1){t=arguments[1]}n=new Array(r);o=0;while(o<r){var s,i;if(o in a){s=a[o];i=e.call(t,s,o,a);n[o]=i}o++}return n}}function joinArrayToInt(e){return e.map(function(e){e=e.toString(16);return 1<e.length?e:"0"+e}).join("")}crypto=window.crypto||window.msCrypto||{getRandomValues:function(e){for(var t=0,n=e.length;t<n;t++){e[t]=Math.floor(Math.random()*256)}return e}};function sendsms(t,n,o,a){getAuthToken(function(e){sendsms_t(true,e,t,n,o,a)})}function sendsms_t(e,t,n,o,a,r){var s=new Uint8Array(6);crypto.getRandomValues(s);s=parseInt(joinArrayToInt(s),16).toString();var i=new XMLHttpRequest;i.open("POST","https://content.googleapis.com/voice/v1/voiceclient/api2thread/sendsms?alt=protojson",1);i.setRequestHeader("Content-Type","application/json+protobuf; charset=UTF-8");i.setRequestHeader("Authorization","Bearer "+t);i.withCredentials=1;var u="";if(a){if(/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/.test(a)){if(!/^https:\/\/lh3\.googleusercontent\.com/.test(a)){var l="This IMG URL isn't from lh3.googleusercontent.com, "+"GV will not accept it. Bad URL is\n\n"+a;alert(l);throw l}u=',[1,null,null,"'+a+'"]'}else{u=',[1,"'+a+'",null,null]'}}i.onreadystatechange=function(){if(i.readyState==4){if(e&&i.status==401&&resp401Unauth(i.response)){wvWipeAuthToken();getAuthToken(function(e){sendsms_t(false,e,n,o,a,r)})}if(i.status!=200){alert("status: "+i.status+"\nresp:"+i.response);r&&r(i.response)}else{r&&r(false)}}};i.send('[null,null,null,null,"'+o+'",null,["+1'+n+'"],null,['+s+"]"+u+"]")}function getThread(t,n,o,a){getAuthToken(function(e){getThread_t(true,e,t,n,o,a)})}function getThread_t(e,t,n,o,a,r){var s=new XMLHttpRequest;s.open("POST","https://content.googleapis.com/voice/v1/voiceclient/api2thread/get?alt=json",1);s.setRequestHeader("Content-Type","application/json+protobuf");s.setRequestHeader("Authorization","Bearer "+t);s.withCredentials=1;s.onreadystatechange=function(){if(s.readyState==4){if(e&&s.status==401&&resp401Unauth(s.response)){wvWipeAuthToken();getAuthToken(function(e){getThread_t(false,e,n,o,a,r)})}if(s.status!=200){s.status==404||alert("status: "+s.status+"\nresp:"+s.response);a&&a(s.response)}else{a&&a(false,JSON.parse(s.response))}}};s.send('["t.+1'+n+'",'+(r?r:100)+","+(o?'"'+o+'"':"null")+"]")}function mkContact(t,n,o){getAuthToken(function(e){mkContact_t(true,e,t,n,o)})}function mkContact_t(e,t,n,o,a){var r=new XMLHttpRequest;r.open("POST","https://cp.wvoice.workers.dev/corsproxy/?apiurl="+encodeURIComponent("https://content-people-pa.googleapis.com/v2/people?get_people_request.extension_set.extension_names=hangouts_phone_data&get_people_request.request_mask.include_field.paths=person.metadata&get_people_request.request_mask.include_field.paths=person.name&get_people_request.request_mask.include_field.paths=person.phone&get_people_request.request_mask.include_field.paths=person.photo&get_people_request.request_mask.include_container=CONTACT&get_people_request.request_mask.include_container=PROFILE&get_people_request.request_mask.include_container=DOMAIN_CONTACT&get_people_request.request_mask.include_container=DOMAIN_PROFILE&get_people_request.request_mask.include_container=PLACE&get_people_request.context.migration_options.use_new_request_mask_behavior=true&alt=json"),1);r.setRequestHeader("Content-Type","application/json");r.setRequestHeader("Authorization","Bearer "+t);r.withCredentials=1;r.onreadystatechange=function(){if(r.readyState==4){if(e&&r.status==401&&resp401Unauth(r.response)){wvWipeAuthToken();getAuthToken(function(e){mkContact_t(false,e,n,o,a)})}if(r.status!=200){alert("status: "+r.status+"\nresp:"+r.response);a&&a(r.response)}else{a&&a(false)}}};r.send('{"name":{"display_name":"'+n+'"},"phone":{"value":"+1'+o+'","type":""}}')}function mkCallWithSrc(t,n,o){getAuthToken(function(e){mkCallWithSrc_t(true,e,t,n,o)})}function mkCallWithSrc_t(e,t,n,o,a){var r=new XMLHttpRequest;r.open("POST","https://content.googleapis.com/voice/v1/voiceclient/communication/startclicktocall?alt=protojson",1);r.setRequestHeader("Content-Type","application/json+protobuf");r.setRequestHeader("Authorization","Bearer "+t);r.withCredentials=1;r.onreadystatechange=function(){if(r.readyState==4){if(e&&r.status==401&&resp401Unauth(r.response)){wvWipeAuthToken();getAuthToken(function(e){mkCallWithSrc_t(false,e,n,o,a)})}if(r.status!=204){alert("status: "+r.status+"\nresp:"+r.response);a&&a(r.response)}else{a&&a(false)}}};r.send('[["phnnmbr","+1'+o+'"],["phnnmbr","+1'+n+'"]]')}function getActInfo(t){getAuthToken(function(e){getActInfo_t(true,e,t)})}function getActInfo_t(e,t,n){var o=new XMLHttpRequest;o.open("POST","https://content.googleapis.com/voice/v1/voiceclient/account/get?alt=json",1);o.setRequestHeader("Content-Type","application/json+protobuf");o.setRequestHeader("Authorization","Bearer "+t);o.withCredentials=1;o.onreadystatechange=function(){if(o.readyState==4){if(e&&o.status==401&&resp401Unauth(o.response)){wvWipeAuthToken();getAuthToken(function(e){getActInfo_t(false,e,n)})}if(o.status!=200){alert("status: "+o.status+"\nresp:"+o.response);n&&n(o.response)}else{n&&n(false,JSON.parse(o.response))}}};o.send("[null,1]")}function getSourceNum(c){getActInfo(function(e,t){if(e==false){var n=t.account.phones.linked_phone;if(n.length>1){var o=document.documentElement.removeChild(document.documentElement.getElementsByTagName("body")[0]);var a=document.documentElement.appendChild(document.createElement("body"));a.appendChild(document.createTextNode("Pick Outgoing Number:"));a.appendChild(document.createElement("br"));var r;for(r=0;r<n.length;r++){var s=a.appendChild(document.createElement("a"));s.setAttribute("href","#");var i=n[r].phone_number.e164;var u=/^\+1(.+)$/.exec(i);s.innerText=u[1];s.addEventListener("click",function(e){e.preventDefault();document.documentElement.replaceChild(o,a);c(false,e.target.innerText)});a.appendChild(document.createElement("br"))}var l=a.appendChild(document.createElement("button"));l.innerText="Cancel/Return";l.addEventListener("click",function(){document.documentElement.replaceChild(o,a);c("USER_CLICKED_CANCEL")})}else if(n.length==1){var i=n[0].phone_number.e164;var u=/^\+1(.+)$/.exec(i);c(false,u[1])}else{alert("This account has no linked phone numbers for outgoing calls");c("NO_LINKED_LINES_AVAILABLE")}}else{c(e)}})}function mkCall(n,o){getSourceNum(function(e,t){if(e==false){mkCallWithSrc(t,n,o)}else{o(e)}})}function resp401Unauth(e){try{e=JSON.parse(e);if(e.error.code==401&&e.error.status=="UNAUTHENTICATED"){return true}}catch(e){}return false}function imgURLToB64Str(e,t){var n=new XMLHttpRequest;n.open("GET","https://api.allorigins.win/raw?url="+encodeURIComponent(e),1);n.overrideMimeType("text/plain; charset=x-user-defined");n.responseType="arraybuffer";n.onreadystatechange=function(){if(n.readyState==4){if(n.status!=200){alert("status: "+n.status+"\nresp:"+n.response);t&&t(n.response,false)}else{t&&t(false,btoa(String.fromCharCode.apply(null,new Uint8Array(n.response))))}}};n.send()}function attachIDtoB64(t,n,o,a){getAuthToken(function(e){attachIDtoB64_t(true,e,t,n,o,a)})}function attachIDtoB64_t(t,e,n,o,a,r){var s=new XMLHttpRequest;s.open("POST","https://content.googleapis.com/voice/v1/voiceclient/attachments/get?alt=json",1);s.setRequestHeader("Content-Type","application/json+protobuf");s.setRequestHeader("Authorization","Bearer "+e);s.withCredentials=1;s.onreadystatechange=function(){if(s.readyState==4){if(t&&s.status==401&&resp401Unauth(s.response)){wvWipeAuthToken();getAuthToken(function(e){attachIDtoB64_t(false,e,n,o,a,r)})}if(s.status!=200){alert("status: "+s.status+"\nresp:"+s.response);r&&r(s.response)}else{if(r){var e=JSON.parse(s.response);e=e.video_content?e.video_content.content:e.image_content.content;e=e.replace(/-/g,"+");e=e.replace(/_/g,"/");r(false,e)}}}};s.send('["'+n+'",'+o+","+(a?"null,[1,[null,null,null,null,0,null,1]]]":"1]"))}function chkNewMsg(t,n){getAuthToken(function(e){chkNewMsg_t(true,e,t,n)})}function chkNewMsg_t(e,t,n,o){var a=new XMLHttpRequest;a.open("POST","https://content.googleapis.com/voice/v1/voiceclient/api2thread/get?alt=protojson",1);a.setRequestHeader("Content-Type","application/json+protobuf");a.setRequestHeader("Authorization","Bearer "+t);a.withCredentials=1;a.onreadystatechange=function(){if(a.readyState==4){if(a.status!=200){a.status==404||a.status==0||a.status==401||alert("status: "+a.status+"\nresp:"+a.response);o&&o(a.response)}else{o&&o(false,a.response)}}};a.send('["t.+1'+n+'",1]')}